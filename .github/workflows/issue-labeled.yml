name: Issue Labeled

on:
  issues:
    types: [labeled]

jobs:
  issue-labeled:
    runs-on: ubuntu-latest
    steps:
      - name: Check if triggered by PCL-Community-Bot
        id: check_trigger
        run: |
          if [ "${{ github.actor }}" == "PCL-Community-Bot" ]; then
            echo "::set-output name=skip::true"
          else
            echo "::set-output name=skip::false"
          fi

      - name: Close as completed
        if: steps.check_trigger.outputs.skip == 'false' && github.event.label.name == 'ğŸ‘Œ å®Œæˆ'
        run: |
          curl -X PATCH \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.BOT }}" \
            https://api.github.com/repos/${{ github.repository }}/issues/${{ github.event.issue.number }} \
            -d '{"state": "closed", "state_reason": "completed"}'

      - name: Close as not planned
        if: steps.check_trigger.outputs.skip == 'false' && (github.event.label.name == 'âŒ å¿½ç•¥' || github.event.label.name == 'âŒ æ‹’ç» / æ”¾å¼ƒ' || github.event.label.name == 'âŒ æš‚æ— è®¡åˆ’' || github.event.label.name == 'âŒ ç¬¬ä¸‰æ–¹' || github.event.label.name == 'ğŸ˜‚ ç§»äº¤ä¸Šæ¸¸')
        run: |
          curl -X PATCH \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.BOT }}" \
            https://api.github.com/repos/${{ github.repository }}/issues/${{ github.event.issue.number }} \
            -d '{"state": "closed", "state_reason": "not_planned"}'

      - name: Report to upstream
        if: steps.check_trigger.outputs.skip == 'false' && github.event.label.name == 'ğŸ˜‚ ç§»äº¤ä¸Šæ¸¸'
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.BOT }}" \
            https://api.github.com/repos/${{ github.repository }}/issues/${{ github.event.issue.number }}/comments \
            -d '{"body": "@${{ github.event.issue.user.login }} è¯¥æè®®ä¸åº”ç”± CE è§£å†³ï¼Œè¯·å‰å¾€ä¸Šæ¸¸ä»“åº“æäº¤ã€‚\næ„Ÿè°¢æ‚¨çš„åé¦ˆã€‚"}'