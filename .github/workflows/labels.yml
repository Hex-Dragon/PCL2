name: Manage Labels on Issue Close

on:
  issues:
    types: [closed]

jobs:
  manage-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Handle labels based on close reason
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.BOT }}
          script: |
            const { issue, repository } = context.payload;
            const labelsToRemove = ['â­• ç­‰å¾…å¤„ç†', 'ğŸš§ æ­£åœ¨å¤„ç†'];
            const closedReason = issue.state_reason;

            // ç§»é™¤æ—§æ ‡ç­¾
            for (const label of labelsToRemove) {
              try {
                await github.rest.issues.removeLabel({
                  owner: repository.owner.login,
                  repo: repository.name,
                  issue_number: issue.number,
                  name: label
                });
              } catch (error) {
                if (error.status !== 404) throw error;
              }
            }

            // æ ¹æ®å…³é—­åŸå› æ·»åŠ æ–°æ ‡ç­¾
            const reasonMapping = {
              'completed': 'ğŸ‘Œ å®Œæˆ',
              'not_planned': 'âŒ å¿½ç•¥',
              'duplicate': 'âŒ é‡å¤'
            };

            if (reasonMapping[closedReason]) {
              await github.rest.issues.addLabels({
                owner: repository.owner.login,
                repo: repository.name,
                issue_number: issue.number,
                labels: [reasonMapping[closedReason]]
              });
            }