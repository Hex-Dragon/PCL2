name: Issue Closed

on:
  issues:
    types: [closed]

jobs:
  process-closed-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Handle completed issue
        if: |
          github.event.issue.state_reason == 'completed' &&
          github.event.sender.login != 'PCL-Community-Bot'
        env:
          BOT_TOKEN: ${{ secrets.BOT }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          REPO_OWNER: ${{ github.repository_owner }}
          REPO_NAME: ${{ github.repository.split('/')[1] }}
          REMOVE_LABELS: '["âŒ å¿½ç•¥","âŒ æ‹’ç» / æ”¾å¼ƒ","âŒ æš‚æ— è®¡åˆ’","âŒ ç¬¬ä¸‰æ–¹","âŒ é‡å¤","â­• ç­‰å¾…å¤„ç†","ğŸ˜‚ ç§»äº¤ä¸Šæ¸¸","ğŸš§ æ­£åœ¨å¤„ç†"]'
          ADD_LABEL: 'ğŸ‘Œ å®Œæˆ'
        run: |
          curl -f -X DELETE \
            -H "Authorization: token $BOT_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/$REPO_OWNER/$REPO_NAME/issues/$ISSUE_NUMBER/labels" \
            -d "$REMOVE_LABELS" || echo "æ ‡ç­¾ç§»é™¤å¤±è´¥æˆ–è¢«è·³è¿‡"
          
          curl -f -X POST \
            -H "Authorization: token $BOT_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/$REPO_OWNER/$REPO_NAME/issues/$ISSUE_NUMBER/labels" \
            -d "{\"labels\":[\"$ADD_LABEL\"]}" || echo "æ ‡ç­¾æ·»åŠ å¤±è´¥"

      - name: Handle duplicate issue
        if: |
          github.event.issue.state_reason == 'duplicate' &&
          github.event.sender.login != 'PCL-Community-Bot'
        env:
          BOT_TOKEN: ${{ secrets.BOT }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          REPO_OWNER: ${{ github.repository_owner }}
          REPO_NAME: ${{ github.repository.split('/')[1] }}
          REMOVE_LABELS: '["âŒ å¿½ç•¥","âŒ æ‹’ç» / æ”¾å¼ƒ","âŒ æš‚æ— è®¡åˆ’","âŒ ç¬¬ä¸‰æ–¹","ğŸ‘Œ å®Œæˆ","â­• ç­‰å¾…å¤„ç†","ğŸ˜‚ ç§»äº¤ä¸Šæ¸¸","ğŸš§ æ­£åœ¨å¤„ç†"]'
          ADD_LABEL: 'âŒ é‡å¤'
        run: |
          curl -f -X DELETE \
            -H "Authorization: token $BOT_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/$REPO_OWNER/$REPO_NAME/issues/$ISSUE_NUMBER/labels" \
            -d "$REMOVE_LABELS" || echo "æ ‡ç­¾ç§»é™¤å¤±è´¥æˆ–è¢«è·³è¿‡"
          
          curl -f -X POST \
            -H "Authorization: token $BOT_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/$REPO_OWNER/$REPO_NAME/issues/$ISSUE_NUMBER/labels" \
            -d "{\"labels\":[\"$ADD_LABEL\"]}" || echo "æ ‡ç­¾æ·»åŠ å¤±è´¥"