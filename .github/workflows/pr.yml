name: Auto Label and Close PRs

on:
  pull_request:
    types: [closed, labeled]

jobs:

  label_on_merge:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true
    steps:
      - name: Add "ğŸ‘Œ å®Œæˆ" label on merge
        uses: actions-ecosystem/action-add-labels@v1
        with:
          labels: "ğŸ‘Œ å®Œæˆ"
          repo-token: ${{ secrets.BOT }}

  close_pr_on_specific_labels:
    runs-on: ubuntu-latest
    if: github.event.action == 'labeled'
    steps:
      - name: Check for specific labels and close PR
        id: check_label
        run: |
          case "${{ github.event.label.name }}" in
            "âŒ å¿½ç•¥"|"âŒ æ‹’ç»"|"âŒ æš‚æ— è®¡åˆ’"|"âŒ ç¬¬ä¸‰æ–¹"|"âŒ é‡å¤"|"ğŸ˜‚ ç§»äº¤ä¸Šæ¸¸")
              echo "::set-output name=should_close::true"
              ;;
            *)
              echo "::set-output name=should_close::false"
              ;;
          esac
      - name: Debugging Information
        if: steps.check_label.outputs.should_close == 'true'
        env:
          BOT_TOKEN: ${{ secrets.BOT }}
        run: |
          echo "Repository: ${{ github.repository }}"
          echo "Pull Request Number: ${{ github.event.pull_number }}"
      - name: Close PR
        if: steps.check_label.outputs.should_close == 'true'
        env:
          BOT_TOKEN: ${{ secrets.BOT }}
        run: |
          curl -X PATCH \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token $BOT_TOKEN" \
            https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_number }} \
            -d '{"state": "closed"}' \
            --verbose
